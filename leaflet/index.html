<!DOCTYPE html>
<html><head>
<title>Rosreestr</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet-src.js"></script>
<script src="TileLayer.Rosreestr.js"></script>
<style>
	html, body, #map {height:100%; width:100%; margin:0}
	.leaflet-clickable-raster-layer {cursor:help}
</style>
</head>

<body>
<div id="map"></div>

<script>
	var osm = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
		maxZoom: 19,
		attribution: 'Map data &copy; OpenStreetMap contributors'
		});
	var map = new L.Map('map', {
		layers: [osm],
		center: new L.LatLng(59.2118, 39.8323),
		zoom: 18
	});

	var rosreestr = L.tileLayer.Rosreestr('http://{s}.pkk5.rosreestr.ru/arcgis/rest/services/Cadastre/Cadastre/MapServer/export?dpi=96&transparent=true&format=png32&bbox={bbox}&size=1024,1024&bboxSR=102100&imageSR=102100&f=image', {
	   tileSize: 1024,
	   clickable: true,
	   attribution: 'Rosreestr'
	}).on('click', function (ev) {
	    console.log('click', ev);
	});

	var LayersControl = L.control.layers({
		osm: osm
	    }, {
		rosreestr: rosreestr
	    }, {collapsed: true}).addTo(map);

	var LeafIcon = L.Icon.extend({
		options: {
			iconSize:     [8, 8],	// размер значка
			iconAnchor:   [4, 4],	// точка значка, которая будет соответствовать местоположению маркера
			popupAnchor:  [0, 0]	// точка, из которой всплывающее окно должно открываться относительно значка
		}
	}), cIcon = [];
	'green,red,orange'.split(',').forEach( function (obj) {cIcon[obj] = new LeafIcon({iconUrl:'https://cyraxxenos.github.io/gis/'+obj+'.png'})} );

	L.marker([59.2118, 39.8323], {icon: cIcon['green']}).addTo(map)
		.bindPopup('A pretty CSS3 popup.<br> Easily customizable.');
</script>
</body>
</html>
